
<!DOCTYPE HTML>
<html lang="en" >
    <head>
        <meta charset="UTF-8">
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <title>SCAR: Scalable Consensus Algorithm Â· Unita Document</title>
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="description" content="">
        <meta name="generator" content="GitBook 3.2.3">
        
        
        
    
    <link rel="stylesheet" href="../../gitbook/style.css">

    
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-katex/katex.min.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-search-pro/search.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-language-picker/plugin.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-highlight/website.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-fontsettings/website.css">
                
            
        

    

    
        
        <link rel="stylesheet" href="../styles/website.css">
        
    
        
    
        
    
        
    
        
    
        
    

        

    
    <meta name="HandheldFriendly" content="true"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../../gitbook/images/apple-touch-icon-precomposed-152.png">
    <link rel="icon" href="https://unita.network/favicon.ico" type="image/x-icon" />
    <link rel="shortcut icon" href="https://unita.network/favicon.ico" type="image/x-icon" />


<link rel="next" href="../Canal-Cross-Chain/" />



    </head>
    <body>
        
<div class="book">
    <div class="book-summary">
        
        <a href="/en/" class="logo">
            <div></div>
        </a>
        
        <div id="book-search-input" role="search">
            <input type="text" placeholder="Type to search" />
        </div>
        
        
        <nav role="navigation">
            


<ul class="summary">
    
    

    

    
        
        <li class="header">Introduction</li>
        
        
    
        <li class="chapter " data-level="1.1" data-path="../">
            
                <a href="../">
            
                    
                    Unita Introduction
            
                </a>
            

            
        </li>
    

    
        
        <li class="header">White Paper</li>
        
        
    
        <li class="chapter " data-level="2.1" >
            
                <a target="_blank" href="ref://en/Whitepaper/unita_whitepaper.pdf">
            
                    
                    Unita White Paper (pdf)
            
                </a>
            

            
        </li>
    

    
        
        <li class="header">Technical Paper</li>
        
        
    
        <li class="chapter active" data-level="3.1" data-path="./">
            
                <a href="./">
            
                    
                    SCAR: Scalable Consensus Algorithm
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.2" data-path="../Canal-Cross-Chain/">
            
                <a href="../Canal-Cross-Chain/">
            
                    
                    Canal: A Cross-chain Trading Solution
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.3" data-path="../DDAO-Data-Management/">
            
                <a href="../DDAO-Data-Management/">
            
                    
                    DDAO: Decentralized Data Access Object
            
                </a>
            

            
        </li>
    

    
        
        <li class="header">Tutorial</li>
        
        
    
        <li class="chapter " data-level="4.1" data-path="../Unita-Quick-Start/">
            
                <a href="../Unita-Quick-Start/">
            
                    
                    Unita Quick Start
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.2" data-path="../One-Click-Launch-Chain/">
            
                <a href="../One-Click-Launch-Chain/">
            
                    
                    Unita One-click Blockchain
            
                </a>
            

            
        </li>
    

    

    <li class="divider"></li>

    <li>
        <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
            Published with GitBook
        </a>
    </li>
</ul>


        </nav>
        
        
    </div>

    <div class="book-body">
        
        <div class="body-inner">
            
            

<div class="book-header" role="navigation">
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href=".." >SCAR: Scalable Consensus Algorithm</a>
    </h1>
</div>




            <div class="page-wrapper" tabindex="-1" role="main">
                <div class="page-inner">
                    
                    <div id="book-search-results">
                        <div class="search-noresults">
                            <section class="normal markdown-section">
                                
                                <h1 id="scar-scalable-consensus-algorithm">SCAR: Scalable Consensus Algorithm</h1>
<h1 id="background">Background</h1>
<p>In order to reduce the fork attack and ensure the reliability of the blockchain network, the block intervals of some well-kown blockchain consensus algorithms, like PoS and PoW, are more than 10 seconds. For example: the  block time interval of Ethereum is 15 seconds, the Qtum is 144 seconds and the Bitcoin is 10 minutes. Howerver, the longer the block interval is, the longer the user will be waiting for the transaction confirmation. It is not good for real-time payment and some other applications.</p>
<p>Some consensus algorithms of the consortium blockchain, such as DPoS(Delegated Proof of Stake) [1] and Aura (Authority Round) [2] ,  reduce the block interval to less than 1 second by voting for the super node to execute the consensus algorithm. But the problem with this is that the number of blocks is too large, which puts a lot of pressure on network and storage. Running a full node, or even a light node that only downloads the block header, has high requirements on the performance of the node device.</p>
<p>For most commercial applications of blockchains, such as credit record and commodity tracking,  the write operations to blockchains are usually periodic. That is to say, the trading volume is large in hours of the day, and the trading volume is small in the remaining hours. For such a scenario, if the high-speed block output is always maintained, it is a big waste for the network and storage resources, and we only ensure that the system has higher performance during the peak hours of the network.</p>
<p>Therefore, we propose the SCAR (Scalable Consensus Algorithm). The idea of SCAR is to adjust parameters dynamically to find a balance between high performance and low load to achieve performance scalability.</p>
<h1 id="related-work">Related Work</h1>
<p>PoW is represented by Bitcoin. The node provides computational power to generate new blocks through a large number of calculations. The higher the power is provided, the faster the block is generated. The calculation difficulty is adjusted every 2016 blocks, ensuring that the block time interval is kept at around 10 minutes in the case of a change in the overall network computing power. Since the block interval is long and the size of each block is limited to 1 MB. Therefore, the network will be seriously congested when the transaction volume is large.</p>
<p>PoS is represented by Qtum. The node provides a token and generates a new block with a small amount of calculation. The larger the token amount is, the faster the block is generated. The calculation difficulty will also be adjusted periodically to ensure that the block time interval is around 144 seconds. Compared with PoW, PoS is more energy efficient since it reduces the computational power requirements. However, since the block interval and the block size limit are still fixed, the load on the network is fixed, and it is impossible to avoid congestion when the transaction volume is large. Although Qtum can manually adjust the block size limit using the DGP(Decentralized Governance Protocol)[3] protocol, this approach is not easy enough.</p>
<p>In PoW and PoS, all nodes of the whole network will participate in the consensus competition, so the block interval cannot be set too small. If it is too small, it is easy to produce a fork. In other words, if the calculation difficulty is set too low, it is easy for a plurality of nodes to generate a new block at the same time.</p>
<p>The consortium blockchain consensus algorithm, such as DPoS and Tendermint, performs consensus by voting the super nodes. Since the number of nodes participating in the consensus is small, the block interval can be set small. For example, the EOS block interval is set to 0.5s. Too short a block interval is a great pressure on bandwidth and hard disk, and it will lead to waste of resources when the transaction volume is small. Since the launch of EOS on June 9 this year, the number of blocks has reached 12 million, but Bitcoin, which started 9 years ago, has only 500,000 blocks.</p>
<h1 id="algorithm-description">Algorithm Description</h1>
<p>An implementation of the SCAR algorithm will be described below. Based on the consortium blockchain, this algorithm dynamically updates the block interval by the transaction volume. It should be noted that the core idea of the SCAR algorithm is to dynamically adjust the performance of the blockchain according to the network load, so the implementation is not limited to the one proposed in this paper, and more implementations need to be further explored.</p>
<p>There are three steps in SCAR:</p>
<blockquote>
<ol>
<li>Count all votes to get the super nodes.</li>
<li>Calculate the block interval based on the network load.</li>
<li>When the interval is over, each super node try to generate a block according to the priority. Once a new block is generated, return to step 1.</li>
</ol>
</blockquote>
<p>The advantages of the SCAR:</p>
<blockquote>
<ol>
<li>Consensus is implemented by the super nodes, the block interval can be greatly shortened, and the transaction confirmation is faster.</li>
<li>The block interval is dynamically adjusted according to the network load. When the network load is reduced, the block interval becomes longer. It will reduce the bandwidth and hard disk pressure.</li>
<li>When less than half of the super nodes are fail, the new block can still be produced, and the system is still robust.</li>
</ol>
</blockquote>
<p>The detail of three steps of the SCAR algorithm will be described separately below.</p>
<h2 id="vote-for-super-nodes">Vote for super nodes</h2>
<p>There are many ways to vote for super nodes. For example, in EOS all users can vote,  and in Aura current super nodes can vote for super nodes of next round. Here we propose a voting strategy based on the Qtum DGP protocol.</p>
<p>When a new blockchain is initialized, the DGP&apos;s smart contract is deployed on the chain, and all admins (administrators) and govs (governors) are initialized in the contract. They are stored in the form of addresses. The DGP protocol supports on-chain voting by these admins and govs to determine if the super nodes should be updated.</p>
<p>First, we will introduce the permissions and modification strategies of the admins and govs. The admins have the highest power to determine the authority. The admins can participate in voting to add and delete admins, govs and super nodes; and the govs can only vote for super nodes. </p>
<p>The voting process is as follows:</p>
<blockquote>
<ol>
<li>Collect new super node proposals, publish to the community and collect feedback;</li>
<li>Adjust the list of super nodes based on community feedback and store them in the blockchain through smart contracts as a new proposal;</li>
<li>Call the corresponding method of the DGP contract to set the proposal to be voted, and the voting is started at this time;</li>
<li>Every admin and gov votes on the proposal by sending a transaction to the voting contract;</li>
<li>If the proposal does not receive enough votes, it will be rejected and no amendments will be implemented;</li>
<li>If the proposal passes, the storage address of the new super node list will be recorded in the DGP contract and will take effect after a certain number of blocks to prevent unnecessary forks.</li>
<li>Every node can get the latest list of super nodes through the DGP contract.</li>
</ol>
</blockquote>
<p>In summary, we can deploy DGP contract on the blockchain, determine the super nodes by DGP voting. And then, we can store and update the list of authorized nodes dynamically .</p>
<h2 id="block-interval">Block interval</h2>
<p>The interval of the block needs to be dynamically adjusted according to the load of the network. When the network is busy, the interval becomes shorter. We propose a calculation method of block interval in this paper, which is calculated according to the number of recent transactions. </p>
<p>The formula for calculating the block interval is as follows:</p>
<p><img src="math1.png" alt="image"></p>
<p>In this formula, min_interval is the minimum block time interval, and max_interval is the maximum block time interval. transaction_num is the average number of transactions in the last m blocks, and m can be an integer greater than or equal to 1. These parameters (m, min_interval, and max_interval) are pre-set by consensus algorithms or smart contract.</p>
<p>The meaning of this formula is:</p>
<blockquote>
<ol>
<li>When the transaction_num is 0, the block interval will be adjusted to max_interval. At this time, the maximum interval set by the system will be used to pack transactions in one block as much as possible. It can avoid waste of storage resource;</li>
<li>When the transaction_num tends to infinity, the block interval will infinitely approach min_interval, and the shortest interval set by the system will be used to ease the transaction congestion of the blockchain network as much as possible.</li>
<li>max_interval and min_interval can be set according to the actual situation (such as user tolerated transaction delay, super node network environment and storage performance, etc.).</li>
</ol>
</blockquote>
<p>By using the consensus algorithm SCAR, which dynamically adjusts the block time interval of the blockchain according to the network load, it can effectively avoid wasting storage resource when the transaction volume is small; also it can increase the block generation rate when the transaction volume is large, package the transaction into the blockchain in time, and guarantee the transaction to be confirmed quickly. The dynamic adjustment of the parameters on the chain also makes the blockchain system more flexible, improves governance efficiency, and reduces the difficulty and cost of governance.</p>
<h2 id="generate-block">Generate block</h2>
<p>After the super node and block interval are determined, the node can take turns to generate a new block after the interval.</p>
<p>At a specific blockchain height, if the number of super nodes is n, SCAR will assign a different block time to each super node. Block_time is as follows:</p>
<p><img src="math2.png" alt="image"></p>
<p>In this formula, parent_block_time is the block time of the previous block and block_interval is dynamically calculated. timeout is used to prevent some super nodes from failing to be out of the block for a long time. The miner_index is the index value; under the same block height, different authorization nodes have different miner_index. The specific reasons and uses of the parameter settings will be explained below.</p>
<p>As shown in the following figure, assume that there are 5 authorized super nodes A, B, C, D, E, their public keys are stored in a ordered list, which is determined by the DGP vote mentioned above. Assume that at height h1, the ordered miners list is [pubkey_A, pubkey_B, pubkey_C, pubkey_D, pubkey_E], and the five supernodes will create new blocks in turn.</p>
<p><img src="1.png" alt="image"></p>
<p>When a new block is created, the miners sign the block with an encryption algorithm and then append the signature to the block. In this way, other nodes can recover the miner&apos;s public key from the block by decryption, thereby verifying whether the miner has the right to create a block by comparing with the super node list. When a chain is signed by the majority of miners, the chain can be viewed as a permanent chain. For example, in the above image, the chain from the genesis block to the height of h3 is a permanent chain because it has been signed by miners D, E and A. If any miner wants to make a fork under height h3, this fork cannot be followed by most miners.</p>
<p>Consensus algorithms can  avoid forks effectively, but at least n/2+1 super nodes need to keep the consensus algorithm running (n is the number of super nodes, n/2 is integer division). The consensus algorithm defines the miners who are allowed to create the next block:</p>
<p>A miner can create a new block in the following situations:</p>
<blockquote>
<ol>
<li>It is authorized currently;</li>
<li>The last n/2 blocks were not created by it.</li>
</ol>
</blockquote>
<p>From the above definition, which super node can generate a new block: the node signed for the nearest n/2 blocks can be removed from the current miner list. For example, at the block height h2, the list of miners in the next block is calculated as shown.</p>
<p><img src="2.png" alt="image"></p>
<p>After selecting the three nodes (B, C, and D) that can generate the next block, we only need to set the super node list as an ordered list, and specify their priority order to avoid them competing for the next block of production.  The miner_index in the formula is the priority index of the sorted miners list. The super node with a higher order will be assigned a earlier block_time, and then each super node will use the allocated block_time to create a new block and keep wait before the block_time is over.</p>
<p>However, the super-node mode of the consortium blockchain also faces a problem: the failure of some nodes will lead to a sudden drop in network efficiency. In order to avoid the failure of some nodes, we add the following strategy to make sure the network works. We set timeout in the system parameters. If a super node fails to broadcast a new block due to a failure, the next super node will replace it after the timeout time and generate the block. As shown in the figure below, in the case of the above five super nodes, Miner B fails when producing a block with a height of h2+1. Subsequently, B&apos;s next node C in the supernode list will broadcast the new block it created after its block_interval+timeout time of parent_block_time.</p>
<p><img src="3.png" alt="image"></p>
<h1 id="implementation">Implementation</h1>
<p>SCAR is implemented in the current version of Unita. Its strategy is that, only when there are unconfirmed transactions in the network, new block will be generated. We plan to improve it afterwards according to its performance in actural usage.</p>
<h1 id="conclusion">Conclusion</h1>
<p>While ensuring the performance of the blockchain, SCAR saves network bandwidth and hard disk consumption as much as possible by adjusting the parameters on the blockchain dynamically. It is more efficient and flexible than other consensus algorithms, and has more advantages in large-scale commercial applications.</p>
<h1 id="references">References</h1>
<p>[1] EOS.IO Technical White Paper v2: Consensus Algorithm (BFT-DPOS). <a href="https://github.com/EOSIO/Documentation/blob/master/TechnicalWhitePaper.md" target="_blank">https://github.com/EOSIO/Documentation/blob/master/TechnicalWhitePaper.md</a>, March 16, 2018</p>
<p>[2] Aura - Authority Round - Wiki. <a href="https://wiki.parity.io/Aura" target="_blank">https://wiki.parity.io/Aura</a></p>
<p>[3] Qtum&#x533A;&#x5757;&#x94FE;&#x6307;&#x5357;. <a href="https://docs.qtum.site/zh/Qtum-Blockchain-Guide.html" target="_blank">https://docs.qtum.site/zh/Qtum-Blockchain-Guide.html</a></p>

                                
                            </section>
                        </div>
                        <div class="search-results">
                            <div class="has-results">
                                
                                <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
                                <ul class="search-results-list"></ul>
                                
                            </div>
                            <div class="no-results">
                                
                                <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
                                
                            </div>
                        </div>
                    </div>
                    
                </div>
            </div>
            
        </div>

        
        
        
        <a href="../Canal-Cross-Chain/" class="navigation navigation-next navigation-unique"
            aria-label="Next page: Canal: A Cross-chain Trading Solution">
            <i class="fa fa-angle-right"></i>
        </a>
        
        
        
    </div>

    <script>
        var gitbook = gitbook || [];
        gitbook.push(function () {
            gitbook.page.hasChanged({"page":{"title":"SCAR: Scalable Consensus Algorithm","level":"3.1","depth":1,"next":{"title":"Canal: A Cross-chain Trading Solution","level":"3.2","depth":1,"path":"Canal-Cross-Chain/README.md","ref":"Canal-Cross-Chain/README.md","articles":[]},"previous":{"title":"Unita White Paper (pdf)","level":"2.1","depth":1,"url":"ref://en/Whitepaper/unita_whitepaper.pdf","ref":"ref://en/Whitepaper/unita_whitepaper.pdf","articles":[]},"dir":"ltr"},"config":{"plugins":["katex","-lunr","-search","search-pro","otherlink","language-picker"],"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"pluginsConfig":{"katex":{},"search-pro":{},"otherlink":{},"language-picker":{"grid-columns":3},"highlight":{},"sharing":{"facebook":true,"twitter":true,"google":false,"weibo":false,"instapaper":false,"vk":false,"all":["facebook","google","twitter","weibo","instapaper"]},"fontsettings":{"theme":"white","family":"sans","size":2},"theme-default":{"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"showLevel":false}},"theme":"default","pdf":{"pageNumbers":true,"fontSize":12,"fontFamily":"Arial","paperSize":"a4","chapterMark":"pagebreak","pageBreaksBefore":"/","margin":{"right":62,"left":62,"top":56,"bottom":56}},"structure":{"langs":"LANGS.md","readme":"README.md","glossary":"GLOSSARY.md","summary":"SUMMARY.md"},"variables":{"host":"doc.unita.network"},"title":"Unita Document","language":"en","gitbook":"*"},"file":{"path":"SCAR-Consensus/README.md","mtime":"2019-03-14T03:28:22.212Z","type":"markdown"},"gitbook":{"version":"3.2.3","time":"2019-03-14T04:18:54.899Z"},"basePath":"..","book":{"language":"en"}});
        });
    </script>
</div>

        
<script src="../../gitbook/gitbook.js"></script>
<script src="../../gitbook/theme.js"></script>


<script src="../../gitbook/gitbook-plugin-search-pro/jquery.mark.min.js"></script>



<script src="../../gitbook/gitbook-plugin-search-pro/search.js"></script>



<script src="../../gitbook/gitbook-plugin-otherlink/js/otherlink.js"></script>



<script src="../../gitbook/gitbook-plugin-language-picker/plugin.js"></script>



<script src="../../gitbook/gitbook-plugin-sharing/buttons.js"></script>



<script src="../../gitbook/gitbook-plugin-fontsettings/fontsettings.js"></script>



    </body>
</html>

